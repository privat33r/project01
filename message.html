<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <title>Project 1</title>
  <meta charset="UTF-8">
</head>

<body>
  <h1 style="color:white;">Test Test Test Test ag</h1>

  <div class="wrap">
<div>
  <h1 class="title"> Filters </h1>

  <div class="byUser">
    <span class="title">All post by User : </span>
    <select id="selUser">
      <option value=0>All</option>
    </select>
    <button type="button" onclick="searchUser()">Search </button>
  </div>
</div>

</div>

<div class="wrap">
  <div><h1 class="title">Posts</h1></div>
  <p class="reply">
  </p>
</div>
<script>
var getData = [];
  var usersList = [];

function status(response) {
  //Check Promise
  if (response.status >= 200 && response.status < 300) {
    return Promise.resolve(response)
  } else {
    return Promise.reject(new Error(response.statusText))
  }
}

function json(response) {
  //Return JSON format
  return response.json()
}

function getUsers(){

  fetch('https://jsonplaceholder.typicode.com/users')
  .then(status)
  .then(json)
  .then(function(dataList) {
    usersList = dataList;
    dataList.forEach(function(data){
      $('#selUser').append($('<option>', {
        value: data.id,
        text : data.name
    }));

    });
    getPosts("");


  })
  .catch(function(error) {
    console.log('Fetch User Error :-S', error);
  });

}

function getPosts(option){

  fetch('https://jsonplaceholder.typicode.com/posts' + option)
  .then(status)
  .then(json)
  .then(function(dataList) {
    getData = dataList;
    var divReply = $(".reply")
    divReply.empty();

    dataList.forEach(function(data){
      var post = $('<p class="post"/>');

      var divID = $('<div class="userName"/>').append($('<span>').append('By: ', usersList[data.userId - 1].name));
      var divTitle = $('<div class="title"/>').append(data.title);
      var divBody = $('<div class="body"/>').append(data.body)

      divReply.append(post.append(divID,divTitle,divBody));

    });

  })
  .catch(function(error) {
    console.log('Fetch Post Error :-S', error);
  });
}



$(document).ready(function() {
  //Get Post On Document Ready
  getUsers();
})

function searchUser(){
  var userSelected = $('#selUser').val();

  if (userSelected != 0){
    getPosts("?userId=" + userSelected);
  }
  else{
    getPosts("");
  }
}
</script>
</body>
</html>
